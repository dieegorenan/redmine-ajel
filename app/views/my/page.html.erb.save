<div class="contextual">
  <%= form_tag({:action => "add_block"}, :remote => true, :id => "block-form") do %>
    <%= label_tag('block-select', l(:button_add)) %>:
    <%= block_select_tag(@user) %>
  <% end %>
</div>

<h2><%=l(:label_my_page)%></h2>

<div id="my-page">
<% @groups.each do |group| %>
  <div id="list-<%= group %>" class="block-receiver">
    <%= render_blocks(@blocks[group], @user) %>
  </div>
<% end %>
</div>

<%= context_menu %>

<%= javascript_tag do %>

<!DOCTYPE HTML>
<html>
<head>
<script>
window.onload = function () {

var chart = new CanvasJS.Chart("chartContainer", {
	theme: "light1", // "light1", "ligh2", "dark1", "dark2"
	animationEnabled: true,
	title: {
		text: "Company Finance"
	},
	axisY: {
		title: "Amount (in USD)",
		prefix: "$",
		lineThickness: 0,
		suffix: "k"
	},
	data: [{
		type: "waterfall",
		indexLabel: "{y}",
		indexLabelFontColor: "#EEEEEE",
		indexLabelPlacement: "inside",
		yValueFormatString: "#,##0k",
		dataPoints: [
			{ label: "Sales",  y: 1273 },
			{ label: "Service", y: 623 },
			{ label: "Total Revenue", isIntermediateSum: true},
			{ label: "Research", y: -150 },
			{ label: "Marketing",  y: -226 },
			{ label: "Salaries", y: -632 },
			{ label: "Operating Income", isCumulativeSum: true },
			{ label: "Taxes",  y: -264 },
			{ label: "Net Income",  isCumulativeSum: true }
		]
	}]
});
chart.render();

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 370px; width: 100%;"></div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>
</html>


$(document).ready(function(){
  $('#block-select').val('');
  $('.block-receiver').sortable({
    connectWith: '.block-receiver',
    tolerance: 'pointer',
    handle: '.sort-handle',
    start: function(event, ui){$(this).parent().addClass('dragging');},
    stop: function(event, ui){$(this).parent().removeClass('dragging');},
    update: function(event, ui){
      // trigger the call on the list that receives the block only
      if ($(this).find(ui.item).length > 0) {
        $.ajax({
          url: "<%= escape_javascript url_for(:action => "order_blocks") %>",
          type: 'post',
          data: {
            'group': $(this).attr('id').replace(/^list-/, ''),
            'blocks': $.map($(this).children(), function(el){return $(el).attr('id').replace(/^block-/, '');})
          }
        });
      }
    }
  });
});
<% end %>

<% html_title(l(:label_my_page)) -%>
